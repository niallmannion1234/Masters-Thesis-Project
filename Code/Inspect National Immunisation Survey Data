# NIS Data Mining
getwd()
setwd("D:\\1 Masters\\Dataset\\Final Datasets")
rawdf <- read.csv("raw.csv", header=T, na.strings=c(""), stringsAsFactors = T)
rawd <- read.csv("rawwer.csv", header=T, na.strings=c(""), stringsAsFactors = T)

install.packages("plyr")
library(plyr)
library(adabag)
library(tuneRanger)
library(mlr)
library(ROSE)
library(tidyverse)
library(BBmisc)

imbalanceddata <- rawd[ ,c(4, 11, 14, 16, 18, 19, 21, 23, 25, 29, 30, 36, 37, 45, 72, 176, 181, 183)]
imbalanceddat <- rawd[ ,c(4, 11, 14, 16, 18, 19, 21, 23, 25, 29, 30, 36, 37, 45, 72, 176, 181, 183)]
colnames(imbalanceddat) = c("Adequate_Data", "Duration_BF", "Household_Size", "Was_Child_Breastfed",
                            "Child_Number", "WIC", "Education_Status", "Firstborn", "Income_Group",
                            "Mother_Age_Group", "Marital_Status", "Race", "House_Ownership_Status",
                            "Provider_Facility", "Vaccination_Status", "Insurance_Type",
                            "Number_Providers", "Region")
colnames(imbalanceddata) = c("Adequate_Data", "Duration_BF", "Household_Size", "Was_Child_Breastfed", 
                             "Child_Number", "WIC", "Education_Status", "Firstborn", "Income_Group",
                             "Mother_Age_Group", "Marital_Status", "Race", "House_Ownership_Status",
                             "Provider_Facility", "Vaccination_Status", "Insurance_Type", "Number_Providers",
                             "Region")
imbalanceddata <- rbind(imbalanceddat, imbalanceddata) 
imbalanceddata<-na.omit(imbalanceddata)
write.csv(imbalanceddata, file= "NIS_dataset.csv") 

setwd("D:\\1 Masters\\Dataset\\Project Datasets")
imbalanceddata <- read.csv("NIS_dataset.csv", header=T, na.strings = c(""), stringsAsFactors = T)

sapply(imbalanceddata, class)
imbalanceddata$Duration <- as.numeric(imbalanceddata$Duration)

# View factor levels
table(imbalanceddata$Provider_Facility)
table(imbalanceddata$Education_Status)
table(imbalanceddata$House_Ownership_Status)
table(imbalanceddata$Firstborn)
table(imbalanceddata$Mother_Age_Group)
table(imbalanceddata$Marital_Status)
table(imbalanceddata$Race)
table(imbalanceddata$Number_Providers)
table(imbalanceddata$Household_Size)
table(imbalanceddata$Insurance_Type)
table(imbalanceddata$Was_Child_Breastfed)
table(imbalanceddata$Child_Number)
table(imbalanceddata$WIC)

# Clean data
imbalanceddata <- imbalanceddata[!grepl("REFUSED|NEVER HEARD OF WIC|DON'T KNOW", imbalanceddata$WIC),]
imbalanceddata <- imbalanceddata[!grepl("OTHER ARRANGMENT|REFUSED|DON'T KNOW", 
                                        imbalanceddata$House_Ownership_Status),]
imbalanceddata <- imbalanceddata[!grepl("DON'T KNOW|REFUSED", imbalanceddata$Was_Child_Breastfed),]
imbalanceddata <- imbalanceddata[!grepl("NA|TYPE OF PROVIDER UNKNOWN|REFUSED",
                                        imbalanceddata$Provider_Facility),]

imbalanceddata$Provider_Facility <- factor(imbalanceddata$Provider_Facility)
imbalanceddata$WIC <- factor(imbalanceddata$WIC)
imbalanceddata$House_Ownership_Status <- factor(imbalanceddata$House_Ownership_Status)
imbalanceddata$Number_Providers <- factor(imbalanceddata$Number_Providers)
imbalanceddata$Was_Child_Breastfed <- factor(imbalanceddata$Was_Child_Breastfed) 
imbalanceddata$Child_Number <- factor(imbalanceddata$Child_Number) 
imbalanceddata$Education_Status <- factor(imbalanceddata$Education_Status) 
imbalanceddata$Mother_Age_Group <- factor(imbalanceddata$Mother_Age_Group) 
imbalanceddata$Marital_Status <- factor(imbalanceddata$Marital_Status) 
imbalanceddata$Race <- factor(imbalanceddata$Race) 
imbalanceddata$Provider_Facility <- factor(imbalanceddata$Provider_Facility) 
imbalanceddata$Insurance_Type <- factor(imbalanceddata$Insurance_Type) 
imbalanceddata$Number_Providers <- factor(imbalanceddata$Number_Providers) 

table(imbalanceddata$Provider_Facility)
table(imbalanceddata$WIC)
table(imbalanceddata$House_Ownership_Status)
table(imbalanceddata$Number_Providers)
table(imbalanceddata$Was_Child_Breastfed)

imbalanceddata <- imbalanceddata[ ,c(3:19)]
